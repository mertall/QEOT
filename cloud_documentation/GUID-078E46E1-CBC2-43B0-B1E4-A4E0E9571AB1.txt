VMware DocsMyLibrarytimesMyLibraryMyLibraryclose-lineIn the Microsoft Azure portal, you create a virtual machine (VM) with the Windows guest operating system that you want to use for the VDI desktops, RDS-based session desktops, or RDS-based remote applications. You create this VM using the same subscription that you used for the Horizon Cloud node. Horizon CloudAbout this taskThis VM must be created on the same Microsoft Azure Vnet (virtual network) to which the node is connected. Also, this VM must be created in the resource group named vmw-hcs-nodeID-base-vms, where nodeID is the node's UUID identifier. Horizon Cloud automatically detects VMs located in that resource group. Then Horizon Cloud will list those VMs on the Inventory screen in the Administration Console if they have Storage-Use managed disk set to Yes. vmw-hcs-nodeID-base-vmsnodeIDnodeIDHorizon CloudHorizon CloudStorage-Use managed diskYesFor master VMs, you can use the following Microsoft Windows VMs that are available in the Microsoft Azure portal's VM catalog, according to your intended usage in Horizon Cloud. Horizon CloudNote:The Import Image automated method of creating a master VM uses the following specific VM families when it creates a master VM. You can choose to use these same patterns when you manually create a master VM, or choose according to the table below. Non-GPU Microsoft Windows Server operating systems: D2 V2 Standard type Non-GPU Microsoft Windows Server operating systems: D2 V2 Standard type Non-GPU Microsoft Windows 10 operating systems: D3 V2 Standard type Non-GPU Microsoft Windows 10 operating systems: D3 V2 Standard type GPU-backed Microsoft Windows Server operating systems: NV6 Standard type GPU-backed Microsoft Windows Server operating systems: NV6 Standard type However, because you will later choose the VM types for the actual RDSH servers and VDI desktops when you create the farms and VDI desktop assignments, there are few reasons to use VM sizes for the master VM that are larger than the ones listed above. Potentially, you might want to try a larger size if you are going to load applications into the master VM and test them out before sealing the master VM. Use Case Use Case Microsoft Azure VM from the Azure Marketplace Names listed below are as they appear in the Microsoft Azure portal when you use the search as you start adding a new VM Microsoft Azure VM from the Azure Marketplace Names listed below are as they appear in the Microsoft Azure portal when you use the search as you start adding a new VM Session-based desktops Session-based desktops Remote applications Remote applications Server operating system Server operating system No GPU acceleration No GPU acceleration Operating systems: Microsoft Windows 2012 R2 Datacenter By Microsoft Microsoft Windows 2016 Datacenter By Microsoft Family: Standard Dv2 vCPUs Operating systems: Microsoft Windows 2012 R2 Datacenter By Microsoft Microsoft Windows 2012 R2 Datacenter By Microsoft Microsoft Windows 2016 Datacenter By Microsoft Microsoft Windows 2016 Datacenter By Microsoft Family: Standard Dv2 vCPUs Session-based desktops Session-based desktops Remote applications Remote applications Server operating system Server operating system GPU acceleration GPU acceleration Operating systems: Microsoft Windows 2016 Datacenter By Microsoft Note: Due to an NVIDIA driver limitation that limits the number of user sessions in Microsoft Windows Server 2012 R2 to a maximum of 20 sessions. using Microsoft Windows Server 2016 is recommended for GPU-enabled session-based desktops and remote applications. Families: Standard NV Family vCPUs, such as NV6, NV12, NV24. Operating systems: Microsoft Windows 2016 Datacenter By Microsoft Microsoft Windows 2016 Datacenter By Microsoft Note:Due to an NVIDIA driver limitation that limits the number of user sessions in Microsoft Windows Server 2012 R2 to a maximum of 20 sessions. using Microsoft Windows Server 2016 is recommended for GPU-enabled session-based desktops and remote applications. Families: Standard NV Family vCPUs, such as NV6, NV12, NV24. VDI desktops VDI desktops Client operating system Client operating system No GPU acceleration No GPU acceleration Note:This release does not support having GPU-backed VDI desktops. Windows 10 Pro, Version 1709 By Microsoft Windows 10 Pro, Version 1709 By Microsoft Windows 10 Pro N, Version 1709 By Microsoft Windows 10 Pro N, Version 1709 By Microsoft VMware Horizon Cloud Service on Microsoft Azure supports RS3 specifically for the Windows 10 Pro Version 1709 and Windows 10 Pro N Version 1709. VMware Horizon Cloud Service on Microsoft AzureFamilies: Standard Av2 Family vCPUs, such as A1_v2, A2_v2, A4_v2, A8_v2 Note:The Microsoft VM types that support GPU acceleration, the NV-series types, are only available in some Microsoft Azure regions. To have GPU-based desktops or remote applications available from the node, the node must be in a Microsoft Azure region in which the specific NV-series VM types are available. See Microsoft Azure Products by region for details. Microsoft Azure Products by regionPrerequisitesObtain the following information about the node for which you are creating the VM. To see this information, open the node's details in the Horizon Cloud Administration Console by navigating to Settings > Capacity and clicking the node's name. Obtain from the node's Summary tab: Horizon CloudSettings > CapacitySettingsCapacityThe name of the virtual network to which your node is connected. You must select the same virtual network when creating the VM. The name of the virtual network to which your node is connected. You must select the same virtual network when creating the VM. The node's UUID for the node for which you are creating the VM. You need this UUID to identify that node's resource groups in the Microsoft Azure portal, so that you know in which resource group to locate the VM. The node's UUID for the node for which you are creating the VM. You need this UUID to identify that node's resource groups in the Microsoft Azure portal, so that you know in which resource group to locate the VM. ProcedureLog in to the Microsoft Azure portal using the Microsoft Azure account associated with the subscription used to deploy the node. Log in to the Microsoft Azure portal using the Microsoft Azure account associated with the subscription used to deploy the node. Navigate into the node's vmw-hcs-nodeID-base-vms resource group by clicking Resource Groups in the portal's left hand navigation, locating that specific resource group, and then clicking on its name. To list only the resource groups for a particular node, on the Resource groups screen, type that node's ID into the Filter by name field. Navigate into the node's vmw-hcs-nodeID-base-vms resource group by clicking Resource Groups in the portal's left hand navigation, locating that specific resource group, and then clicking on its name. vmw-hcs-nodeID-base-vmsnodeIDResource GroupsTo list only the resource groups for a particular node, on the Resource groups screen, type that node's ID into the Filter by name field. Resource groupsFilter by nameIn the screen for that vmw-hcs-nodeID-base-vms resource group, click Add. In the screen for that vmw-hcs-nodeID-base-vms resource group, click Add. vmw-hcs-nodeID-base-vmsnodeIDAddLocate the Microsoft Windows operating system that you want to use. The operating systems supported for use in the base VM depend on the type of master image you want. Image Supported Operating System Names listed below are as they appear in the Microsoft Azure portal when you use the search after clicking Add VDI desktop image Windows 10 Pro, Version 1709 Windows 10 Pro N, Version 1709 RDSH server image Microsoft Windows 2012 R2 Datacenter Microsoft Windows 2016 Datacenter Important: If you want to have GPU-based RDSH desktops, select Microsoft Windows Server 2016. If you select Microsoft Windows Server 2012 R2 instead, an NVIDIA driver limitation will limit the number of end user sessions you can have on each RDS desktop to a maximum of 20 sessions per desktop. Locate the Microsoft Windows operating system that you want to use. The operating systems supported for use in the base VM depend on the type of master image you want. ImageImageSupported Operating System Names listed below are as they appear in the Microsoft Azure portal when you use the search after clicking Add Supported Operating System Names listed below are as they appear in the Microsoft Azure portal when you use the search after clicking Add AddVDI desktop imageVDI desktop imageWindows 10 Pro, Version 1709 Windows 10 Pro, Version 1709 Windows 10 Pro N, Version 1709 Windows 10 Pro N, Version 1709 RDSH server imageRDSH server imageMicrosoft Windows 2012 R2 Datacenter Microsoft Windows 2012 R2 Datacenter Microsoft Windows 2016 Datacenter Microsoft Windows 2016 Datacenter Important:If you want to have GPU-based RDSH desktops, select Microsoft Windows Server 2016. If you select Microsoft Windows Server 2012 R2 instead, an NVIDIA driver limitation will limit the number of end user sessions you can have on each RDS desktop to a maximum of 20 sessions per desktop. Click the one you want for the base VM. Click the one you want for the base VM. In the new pane, verify that the deployment model is set to Resource Manager and then click Create. The portal displays the wizard steps for creating the virtual machine, open to the Basics step. In the new pane, verify that the deployment model is set to Resource Manager and then click Create. Resource ManagerCreateBasicsIn the Basics step, complete the required fields and then click OK to save your values and go to the next step. Option Description Name Give this VM a name of up to 15 alphanumeric characters. VM disk type Keep the default (SSD). You can adjust this setting in the next wizard step. User name Enter a name for the default administrator account. Password Confirm password Enter a password for the default administrator account, and confirm it. The password must adhere to the password complexity rules that Microsoft Azure defines for the VM. Typically the password must be at least 12 characters long have three of the following: one lower case character, one upper case character, one number, and one special character that is not backslash (\) or hyphen (-). Subscription Keep the default setting of your subscription selected. Resource group Verify that Use existing is selected and the selected resource group matches the one from step 2. If it does not match, select the correct resource group (vmw-hcs-nodeID-base-vms). Location Verify that Location matches the Microsoft Azure region in which your node is deployed. Note: If you want to have a GPU-based VM, the node's Microsoft Azure region needs to have the NV-series VM types available. The NV-series types are not available in all Microsoft Azure regions. Already have a Windows license? Choose the selection that is appropriate for your organization. The following screenshot illustrates the settings when Microsoft Windows Server R2 2012 is the selected VM type. In the Basics step, complete the required fields and then click OK to save your values and go to the next step. BasicsOKOptionOptionDescriptionDescriptionNameNameNameGive this VM a name of up to 15 alphanumeric characters.Give this VM a name of up to 15 alphanumeric characters.VM disk typeVM disk typeVM disk typeKeep the default (SSD). You can adjust this setting in the next wizard step.Keep the default (SSD). You can adjust this setting in the next wizard step.SSDUser nameUser nameUser nameEnter a name for the default administrator account.Enter a name for the default administrator account.Password Confirm password Password PasswordConfirm password Confirm passwordEnter a password for the default administrator account, and confirm it. The password must adhere to the password complexity rules that Microsoft Azure defines for the VM. Typically the password must be at least 12 characters long have three of the following: one lower case character, one upper case character, one number, and one special character that is not backslash (\) or hyphen (-). Enter a password for the default administrator account, and confirm it. The password must adhere to the password complexity rules that Microsoft Azure defines for the VM. Typically the password must be at least 12 characters long have three of the following: one lower case character, one upper case character, one number, and one special character that is not backslash (\) or hyphen (-). SubscriptionSubscriptionSubscriptionKeep the default setting of your subscription selected.Keep the default setting of your subscription selected.Resource groupResource groupResource groupVerify that Use existing is selected and the selected resource group matches the one from step 2. If it does not match, select the correct resource group (vmw-hcs-nodeID-base-vms).Verify that Use existing is selected and the selected resource group matches the one from step 2. If it does not match, select the correct resource group (vmw-hcs-nodeID-base-vms).Use existingvmw-hcs-nodeID-base-vmsnodeIDLocationLocationLocationVerify that Location matches the Microsoft Azure region in which your node is deployed. Note: If you want to have a GPU-based VM, the node's Microsoft Azure region needs to have the NV-series VM types available. The NV-series types are not available in all Microsoft Azure regions. Verify that Location matches the Microsoft Azure region in which your node is deployed. LocationNote:If you want to have a GPU-based VM, the node's Microsoft Azure region needs to have the NV-series VM types available. The NV-series types are not available in all Microsoft Azure regions. Already have a Windows license?Already have a Windows license?Already have a Windows license?Choose the selection that is appropriate for your organization.Choose the selection that is appropriate for your organization.The following screenshot illustrates the settings when Microsoft Windows Server R2 2012 is the selected VM type. In the Size step, select a size for the VM and then click Select to save your selection and go to the next step. You might see the pane displaying the VM size options as selectable blocks. If that happens, you might have to click View all to see more size options. Note: To have GPU-based desktops for server VM, change Supported disk type to HDD and select one of the NV-series family types. Only the NV-series types allow installation of the GPU drivers. NV6 Standard is a typical choice. Option Description Supported disk type To have GPU-acceleration in a server VM, select HDD. Otherwise, you can either keep the default SSD setting or select HDD, according to your needs. VM size Select the VM profile. To have GPU-acceleration, select one of the NV-series family types. NV6 Standard is a typical choice. Otherwise, for a VM without GPU-acceleration, use one of the other supported series, as described in the table above. Note: This release does not support using GPU-backed VMs for the Windows 10 operating system VMs. In the Size step, select a size for the VM and then click Select to save your selection and go to the next step. SizeSelectYou might see the pane displaying the VM size options as selectable blocks. If that happens, you might have to click View all to see more size options. View allNote:To have GPU-based desktops for server VM, change Supported disk type to HDD and select one of the NV-series family types. Only the NV-series types allow installation of the GPU drivers. NV6 Standard is a typical choice. Supported disk typeHDDOptionOptionDescriptionDescriptionSupported disk typeSupported disk typeSupported disk typeTo have GPU-acceleration in a server VM, select HDD. Otherwise, you can either keep the default SSD setting or select HDD, according to your needs.To have GPU-acceleration in a server VM, select HDD. Otherwise, you can either keep the default SSD setting or select HDD, according to your needs.HDDSSDHDDVM sizeVM sizeVM sizeSelect the VM profile. To have GPU-acceleration, select one of the NV-series family types. NV6 Standard is a typical choice. Otherwise, for a VM without GPU-acceleration, use one of the other supported series, as described in the table above. Note: This release does not support using GPU-backed VMs for the Windows 10 operating system VMs. Select the VM profile. To have GPU-acceleration, select one of the NV-series family types. NV6 Standard is a typical choice. Otherwise, for a VM without GPU-acceleration, use one of the other supported series, as described in the table above. Note:This release does not support using GPU-backed VMs for the Windows 10 operating system VMs. In the Settings step, configure the virtual network and subnet settings as described below, and then click OK to save your entries and go to the next step. Keep the default values for the other settings. Important: You must keep Storage - Use managed disk set to Yes. If the VM does not have Storage - Use managed disk set to Yes before you run the installer that installs the agent-related software components, Horizon Cloud cannot use this VM and you will have to create a new one to use. As described in the prerequisites section above, you must set the Virtual network to the same one that the node uses. Do not alter the defaults for the other options in the Settings screen (such as no extensions, etc). Keep the defaults for those options. Do not make changes other than what is mentioned below. Option Description Storage - Use managed disk Set this option to Yes (the default). Caution: Ensure this option is set to Yes. Otherwise, your VM will be unusable in Horizon Cloud. Virtual network Click Virtual network and select the same virtual network to which the node is connected. Subnet Click Subnet and select the one named vmw-hcs-nodeID-net-tenant. To see their full names, hover over each one and see the names in the tooltips. After you click OK, a validation runs. When it passes, the wizard moves to the final step. In the Settings step, configure the virtual network and subnet settings as described below, and then click OK to save your entries and go to the next step. SettingsOKKeep the default values for the other settings. Important:You must keep Storage - Use managed disk set to Yes. If the VM does not have Storage - Use managed disk set to Yes before you run the installer that installs the agent-related software components, Horizon Cloud cannot use this VM and you will have to create a new one to use. You must keep Storage - Use managed disk set to Yes. If the VM does not have Storage - Use managed disk set to Yes before you run the installer that installs the agent-related software components, Horizon Cloud cannot use this VM and you will have to create a new one to use. Storage - Use managed diskYesStorage - Use managed diskYesHorizon CloudAs described in the prerequisites section above, you must set the Virtual network to the same one that the node uses. As described in the prerequisites section above, you must set the Virtual network to the same one that the node uses. Virtual networkDo not alter the defaults for the other options in the Settings screen (such as no extensions, etc). Keep the defaults for those options. Do not make changes other than what is mentioned below. Do not alter the defaults for the other options in the Settings screen (such as no extensions, etc). Keep the defaults for those options. Do not make changes other than what is mentioned below. OptionOptionDescriptionDescriptionStorage - Use managed diskStorage - Use managed diskStorage - Use managed diskSet this option to Yes (the default). Caution: Ensure this option is set to Yes. Otherwise, your VM will be unusable in Horizon Cloud. Set this option to Yes (the default). YesCaution:Ensure this option is set to Yes. Otherwise, your VM will be unusable in Horizon Cloud. YesHorizon CloudVirtual networkVirtual networkVirtual networkClick Virtual network and select the same virtual network to which the node is connected.Click Virtual network and select the same virtual network to which the node is connected.Virtual networkSubnetSubnetSubnetClick Subnet and select the one named vmw-hcs-nodeID-net-tenant. To see their full names, hover over each one and see the names in the tooltips.Click Subnet and select the one named vmw-hcs-nodeID-net-tenant. To see their full names, hover over each one and see the names in the tooltips.Subnetvmw-hcs-nodeID-net-tenantnodeIDAfter you click OK, a validation runs. When it passes, the wizard moves to the final step. OKIn the final step, review the summary and verify the settings, especially the resource group, virtual network, subnet, and Managed set to Yes. The resource group and subnet names should contain the node's UUID (nodeID). Setting Value Resource group vmw-hcs-nodeID-base-vms Managed Yes Virtual network The node's virtual network. Subnet vmw-hcs-nodeID-net-tenant In the final step, review the summary and verify the settings, especially the resource group, virtual network, subnet, and Managed set to Yes. ManagedYesThe resource group and subnet names should contain the node's UUID (nodeID). nodeIDSettingSettingValueValueResource groupResource groupvmw-hcs-nodeID-base-vmsvmw-hcs-nodeID-base-vmsvmw-hcs-nodeID-base-vmsnodeIDManagedManagedYesYesYesVirtual networkVirtual networkThe node's virtual network.The node's virtual network.SubnetSubnetvmw-hcs-nodeID-net-tenantvmw-hcs-nodeID-net-tenantvmw-hcs-nodeID-net-tenantnodeIDStart deploying the VM by clicking the button at the bottom of the pane. Start deploying the VM by clicking the button at the bottom of the pane. ResultsHorizon CloudNot PairedWhat to do nextFully deploying the VM can take several minutes. When the portal's dashboard indicates the VM is created and ready, make a remote desktop connection to the VM's public IP address and continue configuring the base VM. Complete the steps in Prepare the Manually Created Master VM Prior to Installing the Agents. Prepare the Manually Created Master VM Prior to Installing the AgentsParent topic:Manually Build the Master Virtual Machine in Microsoft AzureNext topic:Prepare the Manually Created Master VM Prior to Installing the AgentsVMware, Inc x 