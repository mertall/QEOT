VMware DocsMyLibrarytimesMyLibraryMyLibraryclose-lineAfter the master server image virtual machine (VM) is created, but before converting it into a published image in Horizon Cloud, you customize the guest Windows server operating system (OS) to install and configure all of the things you want to have in your end users' RDS desktops. At this time, you install all of the third-party applications you want available in the RDS desktops or available for assignment as remote applications. Also at this time, you perform any other customizations in the Windows guest operating system, such as installing special drivers required by your organization's needs, applying wallpaper, setting default colors and fonts, configuring taskbar settings, and other such OS-level items. Horizon CloudAbout this taskAfter the Imported VMs page indicates that your master image virtual machine (VM) has its agent-related status as active, you connect to it using your RDP software and install the applications into the underlying Windows server operating system. For Microsoft's best practices about installing applications directly on to an RDSH server, see the TechNet Magazine article Learn How to Install Applications on an RD Session Host Server. Learn How to Install Applications on an RD Session Host ServerPrerequisitesVerify the Imported VMs page indicates the agent-related status is active for the VM. Obtain the VM's IP address as displayed on the Imported VMs page. Note:When using the Microsoft Remote Desktop Client as your RDP software to connect to the master VM, ensure it is the most up-to-date version. For example, the default RDP software in the Windows 7 operating system is not at a high enough version. The version must be version 8 or higher. Verify you have at least one of the following credentials (user name and password) to log in to the VM's guest Windows operating system: The credentials for the local administrator account that was specified in the Import Image wizard when this master image VM was created, as described in Create a Master Virtual Machine Automatically from the Microsoft Azure Marketplace. The credentials for the local administrator account that was specified in the Import Image wizard when this master image VM was created, as described in Create a Master Virtual Machine Automatically from the Microsoft Azure Marketplace. Create a Master Virtual Machine Automatically from the Microsoft Azure MarketplaceThe credentials for a domain account that is configured in the image VM's DaaS Direct Connect Users local group, as described in Configure the Ability for Domain Accounts to Remote Connect to the Imported Image. The credentials for a domain account that is configured in the image VM's DaaS Direct Connect Users local group, as described in Configure the Ability for Domain Accounts to Remote Connect to the Imported Image. Configure the Ability for Domain Accounts to Remote Connect to the Imported ImageImportant:By default, the installed Horizon agent software prevents using accounts other than the local administrator account to make RDP connections to the configured image. If your organization has a policy that prevents use of the local administrator account on domain-joined VMs, you must first configure the image VM's DaaS Direct Connect Users local group with the non-local domain accounts you want connecting to the VM to customize the image. For those steps, see Configure the Ability for Domain Accounts to Remote Connect to the Imported Image. Configure the Ability for Domain Accounts to Remote Connect to the Imported ImageProcedureUse the VM's IP address in your RDP software to connect to the RDS-enabled Windows server operating system. If the master image VM was created with a public IP address, you can use that IP address in your RDP software If the master image VM has a private IP address, you must RDP into it by one of these two methods: Using another VM in your Microsoft Azure subscription that does have a public IP address and doing an outbound RDP into the master image VM. Use your VPN and RDP into the master image VM over your corporate network Note: To access a VM that is running the agent-related software components, the version of the Remote Desktop Client must be version 8 or later. Otherwise, the connection fails. Using the most up-to-date Remote Desktop Client is recommended. Use the VM's IP address in your RDP software to connect to the RDS-enabled Windows server operating system. If the master image VM was created with a public IP address, you can use that IP address in your RDP software If the master image VM was created with a public IP address, you can use that IP address in your RDP software If the master image VM has a private IP address, you must RDP into it by one of these two methods: Using another VM in your Microsoft Azure subscription that does have a public IP address and doing an outbound RDP into the master image VM. Use your VPN and RDP into the master image VM over your corporate network If the master image VM has a private IP address, you must RDP into it by one of these two methods: Using another VM in your Microsoft Azure subscription that does have a public IP address and doing an outbound RDP into the master image VM. Using another VM in your Microsoft Azure subscription that does have a public IP address and doing an outbound RDP into the master image VM. Use your VPN and RDP into the master image VM over your corporate network Use your VPN and RDP into the master image VM over your corporate network Note:To access a VM that is running the agent-related software components, the version of the Remote Desktop Client must be version 8 or later. Otherwise, the connection fails. Using the most up-to-date Remote Desktop Client is recommended. Log in to the RDS-enabled Windows server operating system using the user name and password that was specified in Import Image wizard when the master image VM was created. Enter the username as \username. This account is a local administration account. Note: If you configured the DaaS Direct Connect Users group with domain accounts, you can use one of those accounts to log in. In that case, enter the user name as domain\username where domain is the name of the domain. Log in to the RDS-enabled Windows server operating system using the user name and password that was specified in Import Image wizard when the master image VM was created. Enter the username as \username. This account is a local administration account. Note:If you configured the DaaS Direct Connect Users group with domain accounts, you can use one of those accounts to log in. In that case, enter the user name as domain\username where domain is the name of the domain. domain\usernamedomaindomainWhen you are logged in to the operating system, follow these steps to install the third-party applications or drivers that you want available to run in the multi-user RDS desktop environment. In the Windows Server operating system, open a command prompt as an administrator by right-clicking the Start and clicking Command Prompt (Admin). In that command prompt, determine the server's current install mode of the server by issuing the command change user /query. The response Applicaton EXECUTE mode is enabled indicates the server is in RD-Execute mode. In that command prompt, switch the server into RD-Install mode by issuing the command change user /install. As described in the Microsoft best practices document, RD-Install is a special install mode to install applications so they can run in a multi-user environment. Install the third-party user applications you want to provide to your end users in their RDS desktops or as remote applications. When you are finished installing the applications, return to the command prompt window and switch the server into RD-Execute mode by issuing the command change user /execute. When you are logged in to the operating system, follow these steps to install the third-party applications or drivers that you want available to run in the multi-user RDS desktop environment. In the Windows Server operating system, open a command prompt as an administrator by right-clicking the Start and clicking Command Prompt (Admin). In the Windows Server operating system, open a command prompt as an administrator by right-clicking the Start and clicking Command Prompt (Admin). StartCommand Prompt (Admin)In that command prompt, determine the server's current install mode of the server by issuing the command change user /query. The response Applicaton EXECUTE mode is enabled indicates the server is in RD-Execute mode. In that command prompt, determine the server's current install mode of the server by issuing the command change user /query. change user /queryThe response Applicaton EXECUTE mode is enabled indicates the server is in RD-Execute mode. Applicaton EXECUTE mode is enabledIn that command prompt, switch the server into RD-Install mode by issuing the command change user /install. As described in the Microsoft best practices document, RD-Install is a special install mode to install applications so they can run in a multi-user environment. In that command prompt, switch the server into RD-Install mode by issuing the command change user /install. change user /installAs described in the Microsoft best practices document, RD-Install is a special install mode to install applications so they can run in a multi-user environment. Install the third-party user applications you want to provide to your end users in their RDS desktops or as remote applications. Install the third-party user applications you want to provide to your end users in their RDS desktops or as remote applications. When you are finished installing the applications, return to the command prompt window and switch the server into RD-Execute mode by issuing the command change user /execute. When you are finished installing the applications, return to the command prompt window and switch the server into RD-Execute mode by issuing the command change user /execute. change user /executeIn the operating system, install any custom drivers you want in the RDS desktops. In the operating system, install any custom drivers you want in the RDS desktops. Make any customizations or configurations you want to have in the RDS desktops, such as add a custom wallpaper, set default fonts or colors or themes, adjust the taskbar default settings, and so on. Make any customizations or configurations you want to have in the RDS desktops, such as add a custom wallpaper, set default fonts or colors or themes, adjust the taskbar default settings, and so on. When you are done adding your finishing touches to the VM's guest operating system, sign out of the operating system. When you are done adding your finishing touches to the VM's guest operating system, sign out of the operating system. What to do nextFollow the best practices to optimize the VM to prevent encountering sysprep or other errors during the process to convert the master image. See Customize the Master Image VM's Windows Operating System. Customize the Master Image VM's Windows Operating SystemConvert the master image VM to an assignable image, using the steps described in Convert a Configured Master Virtual Machine to an Assignable Image. Convert a Configured Master Virtual Machine to an Assignable ImageParent topic:Customize the Master Image VM's Windows Operating SystemVMware, Inc x 